<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>OWL EL Reasoner</title>
        <script src="owl.js" type="text/javascript"></script>
        <script src="query.js" type="text/javascript"></script>
        <script src="util.js" type="text/javascript"></script>
        <link rel="stylesheet" href="style.css" type="text/css" />
        <script type="text/javascript">
           // Holds reference to the reasoner after some ontology is classified.
           var reasoner = undefined;
           
           /**
            * Shows the given error message in the browser.
            * 
            * @param msg Error message to show in the browser.
            */
           function handleError(msg)
           {
              alert('ERROR: ' + msg);
           }
           
           /**
            * Toggles the visibility of the ontology text box on the page. 
            */
           function toggleOntologyTextVisibility()
           {
              var ontologyText = document.getElementById('ontologyText');
              
              if (ontologyText.style.display == 'block')
              {
                 ontologyText.style.display = 'none';
              }
              else
              {
                 ontologyText.style.display = 'block';
              }
           }
           
           /***
            * Fills the given Select box with names of classes from the given 'associative array'.
            * 
            * @param selectBox Select box to fill.
            * @param classes 'Associative array' with classes to add to the select box.
            */
           function fillSelectWithClassNames(selectBox, classes)
           {
              for (var name in classes)
              {
                 var option = document.createElement('option');
                 option.text = name;
                 option.value = name;
                 selectBox.add(option, null);
              }
           }
           
           /**
            * Parses the ontology from the given OWL/XML and builds a reasoner object for it.
            */ 
           function classifyBtnClicked()
           {
              //try 
              //{
                 var owlXml = document.getElementById('ontologyText').value;
                 
                 var totalClock = new Stopwatch();
                 var clock = new Stopwatch();
                 
                 totalClock.start();
                 clock.start();
                 var ontology = owl.xml.parse(owlXml, handleError);
                 var parsingTime = clock.stop();
                 
                 clock.start();
                 reasoner = new owl.Reasoner(ontology);
                 var classificationTime = clock.stop(); 
                 var totalTime = totalClock.stop();
                 
                 // Hide the Classify button and the ontology text.
                 document.getElementById('sampleOntologies').style.display = 'none';
                 document.getElementById('classifyBtn').style.display = 'none';
                 document.getElementById('ontologyText').style.display = 'none';
                 
                 // Display the classification information.
                 document.getElementById('parsingTime').innerHTML = parsingTime;
                 document.getElementById('normalizationTime').innerHTML = 
                    reasoner.timeInfo.normalization;
                 document.getElementById('opropSubsumptionTime').innerHTML = 
                    reasoner.timeInfo.objectPropertySubsumption;
                 document.getElementById('classificationTime').innerHTML = 
                    reasoner.timeInfo.classification;
                 document.getElementById('aBoxRewritingTime').innerHTML = 
                    reasoner.timeInfo.aBoxRewriting;
                 document.getElementById('totalTime').innerHTML = totalTime;
                 document.getElementById('classCount').innerHTML = ontology.getClassCount();
                 document.getElementById('opropCount').innerHTML = 
                    ontology.getObjectPropertyCount();
                 document.getElementById('classifyOutcome').style.display = 'block';
                 
                 // Display the query box.
                 var classes = ontology.getClasses();
                 fillSelectWithClassNames(document.getElementById('subsumee'), classes);
                 fillSelectWithClassNames(document.getElementById('subsumer'), classes)
                 document.getElementById('queryBox').style.display = 'block';
              /*}
              catch (ex)
              {
                 handleError(ex);
              }*/
           }
           
           /**
            * Processes the query from the given string and outputs the result.
            */
           function queryBtnClicked()
           {
              try 
              {
                 if (!reasoner)
                 {
                    throw 'The reasoner has not been initialized yet!';
                 }
                 
                 var queryTxt = document.getElementById('queryText').value;
                 
                 var stopwatch = new Stopwatch();
                 stopwatch.start();
                 var query = owl.sparql.parse(queryTxt);
                 var result = reasoner.answerQuery(query);
                 var time = stopwatch.stop();
                 
                 var queryResults = document.getElementById('queryResults');
                 queryResults.innerHTML += 
                    "<br />" + '"' + queryTxt + '": ' +  result + ' (answered in ' + time + ')';
              }
              catch (ex)
              {
                 handleError(ex);
              }
           }
           
           /**
            * Checks if the given subsumption holds.
            */
           function subsumptionBtnClicked()
           {
              try
              {
                 if (!reasoner)
                 {
                    throw 'The reasoner has not been initialized yet!';
                 }
                 
                 var stopwatch = new Stopwatch();
                 stopwatch.start();
                 var subsumeeBox = document.getElementById('subsumee');
                 var subsumerBox = document.getElementById('subsumer');
                 var result = reasoner.isSubclass(
                    subsumeeBox.options[subsumeeBox.selectedIndex].value, 
                    subsumerBox.options[subsumerBox.selectedIndex].value)
                 var time = stopwatch.stop();
                 
                 var subsumptionResult = document.getElementById('subsumptionResult');
                 subsumptionResult.innerHTML = result + ' (answered in ' + time + ')';
              }
              catch (ex)
              {
                 handleError(ex);
              }
           }
           
           /**
            * Loads ontology stored at the given path into the ontology text box.
            * 
            * @param url URL of the file containing an ontology to load.
            */
           function loadOntologyFile(url)
           {
              try
              {
                 var file = new TextFile(url);
                 document.getElementById('ontologyText').value = file.getText();
              }
              catch (ex)
              {
                 handleError(ex);
              }
           }
        </script>
    </head>
    <body>
      <div id="page">
         <h1>OWL EL Reasoner</h1>
         <div id="ontologyBox">
            <div id="classifyOutcome">
               Parsing OWL/XML took: <span id="parsingTime">[not processed yet]</span><br />
               Normalization took: <span id="normalizationTime">[not processed yet]</span><br />
               Object property subsumption took: <span id="opropSubsumptionTime">[not processed yet]</span><br />
               Classification took: <span id="classificationTime">[not processed yet]</span><br />
               ABox rewriting took: <span id="aBoxRewritingTime">[not processed yet]</span><br />
               Total time: <span id="totalTime">[not processed yet]</span><br /><br />
               Number of classes in the ontology: <span id="classCount">[not processed yet]</span><br />
               Number of object properties in the ontology: <span id="opropCount">[not processed yet]</span>
               <br /><br />
               <a href="ontologyText.html" onclick="toggleOntologyTextVisibility(); return false;">[Show/hide ontology text]</a>
            </div>
            <div id="sampleOntologies">
               Test ontologies: 
               <a href="tests/subsumption/test1.owl" onclick="loadOntologyFile('test1.owl'); return false;">Test #1</a> |
	            <a href="tests/subsumption/test2.owl" onclick="loadOntologyFile('test2.owl'); return false;">Test #2</a> |
	            <a href="tests/subsumption/test3.owl" onclick="loadOntologyFile('test3.owl'); return false;">Test #3</a> |
               <a href="tests/subsumption/not-galen.owl" onclick="loadOntologyFile('tests/subsumption/not-galen.owl'); return false;">NOT-GALEN</a>
            </div>
	         <textarea id="ontologyText" cols="40" rows="20" placeholder="Please input OWL\XML ontology here."></textarea>
            <input type="button" id="classifyBtn" value="Classify" onclick="classifyBtnClicked();"/>
         </div>
         <div id="queryBox">
            Class subsumption:
            <select id="subsumee">
            </select>
            is
            <select id="subsumer">
            </select>
            <input type="button" id="subsumptionBtn" value="Check" onclick="subsumptionBtnClicked();" /><span id="subsumptionResult"></span><br /><br />
            SPARQL query:
            <textarea id="queryText" cols="40" rows="5" placeholder="Please input your SPARQL query here."></textarea>
            <input type="button" id="queryBtn" value="Execute" onclick="queryBtnClicked();"/>
            <br/><br />Results:
            <div id="queryResults"></div>
         </div>
      </div>
    </body>
</html>